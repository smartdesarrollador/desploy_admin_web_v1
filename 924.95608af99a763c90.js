"use strict";(self.webpackChunkmy_primer_proy_angular=self.webpackChunkmy_primer_proy_angular||[]).push([[924],{4924:(S,v,l)=>{l.r(v),l.d(v,{CuentaComponent:()=>Q});var e=l(9212),Z=l(6814),n=l(6223),U=l(131),C=l(1474),d=l(553);function y(t,i){if(1&t&&(e.TgZ(0,"div",37)(1,"span",38),e._uU(2),e.qZA()()),2&t){const s=e.oxw();e.xp6(2),e.Oqu(s.successMessage())}}function F(t,i){if(1&t&&(e.TgZ(0,"div",39)(1,"span",38),e._uU(2),e.qZA()()),2&t){const s=e.oxw();e.xp6(2),e.Oqu(s.errorMessage())}}function x(t,i){1&t&&(e.TgZ(0,"span",40),e._uU(1,"refresh"),e.qZA())}function A(t,i){1&t&&(e.TgZ(0,"p",41),e._uU(1," El nombre es obligatorio "),e.qZA())}function P(t,i){1&t&&(e.TgZ(0,"p",41),e._uU(1," Introduce un correo electr\xf3nico v\xe1lido "),e.qZA())}function M(t,i){1&t&&(e.TgZ(0,"div")(1,"label",42),e._uU(2,"Rol"),e.qZA(),e.TgZ(3,"select",43)(4,"option",44),e._uU(5,"Autor"),e.qZA(),e.TgZ(6,"option",45),e._uU(7,"Administrador"),e.qZA()()())}function I(t,i){1&t&&(e.TgZ(0,"div",46),e._UZ(1,"input",47),e.qZA())}function q(t,i){1&t&&(e.TgZ(0,"span",40),e._uU(1,"refresh"),e.qZA())}function N(t,i){1&t&&(e.TgZ(0,"p",41),e._uU(1," La contrase\xf1a actual es obligatoria "),e.qZA())}function J(t,i){1&t&&(e.TgZ(0,"p",41),e._uU(1," La nueva contrase\xf1a es obligatoria "),e.qZA())}function E(t,i){1&t&&(e.TgZ(0,"p",41),e._uU(1," La contrase\xf1a debe tener al menos 8 caracteres "),e.qZA())}function L(t,i){1&t&&(e.TgZ(0,"p",41),e._uU(1," Confirma tu contrase\xf1a "),e.qZA())}function k(t,i){1&t&&(e.TgZ(0,"p",41),e._uU(1," Las contrase\xf1as no coinciden "),e.qZA())}function O(t,i){1&t&&(e.TgZ(0,"span",40),e._uU(1,"refresh"),e.qZA())}let Q=(()=>{class t{constructor(){this.authService=(0,e.f3M)(U.e),this.fb=(0,e.f3M)(n.qu),this.http=(0,e.f3M)(C.eN),this.isLoading=(0,e.tdS)(!1),this.successMessage=(0,e.tdS)(""),this.errorMessage=(0,e.tdS)(""),this.selectedFile=null,this.previewUrl=null,this.showCurrentPassword=(0,e.tdS)(!1),this.showNewPassword=(0,e.tdS)(!1),this.showConfirmPassword=(0,e.tdS)(!1),this.currentUser=null,this.isAdmin=(0,e.tdS)(!1)}ngOnInit(){this.currentUser=this.authService.currentUser(),this.isAdmin.set("administrador"===this.currentUser?.rol),this.initForms(),this.loadProfileImage()}getAuthHeaders(){const s=this.authService.getToken();return{headers:new C.WM({Authorization:`Bearer ${s}`})}}initForms(){this.profileForm=this.fb.group({name:[this.currentUser?.name||"",[n.kI.required]],email:[this.currentUser?.email||"",[n.kI.required,n.kI.email]],rol:[this.currentUser?.rol||"",[n.kI.required]]}),this.passwordForm=this.fb.group({current_password:["",[n.kI.required,n.kI.minLength(8)]],password:["",[n.kI.required,n.kI.minLength(8)]],password_confirmation:["",[n.kI.required]]},{validators:this.passwordMatchValidator})}togglePasswordVisibility(s){"current"===s?this.showCurrentPassword.set(!this.showCurrentPassword()):"new"===s?this.showNewPassword.set(!this.showNewPassword()):"confirm"===s&&this.showConfirmPassword.set(!this.showConfirmPassword())}passwordMatchValidator(s){const o=s.get("password")?.value,r=s.get("password_confirmation")?.value;return o===r?null:{mismatch:!0}}loadProfileImage(){if(!this.currentUser)return;const s=d.N.urlRaiz.replace(/\/api$/,""),o=new Image;o.onload=()=>{this.previewUrl=`${s}/assets/images/profiles/${this.currentUser?.id}.jpg?t=${(new Date).getTime()}`},o.onerror=()=>{this.previewUrl=`${s}/assets/images/profiles/default.png`},o.src=`${s}/assets/images/profiles/${this.currentUser.id}.jpg`}onFileSelected(s){const o=s.target;if(o.files&&o.files.length){const r=o.files[0];if(!r.type.match(/image\/(jpeg|jpg|png)/))return void this.errorMessage.set("Solo se permiten archivos JPG o PNG");if(r.size>2097152)return void this.errorMessage.set("La imagen no debe superar los 2MB");this.selectedFile=r,this.previewUrl=URL.createObjectURL(r),this.errorMessage.set("")}}uploadImage(){if(!this.selectedFile||!this.currentUser)return;const s=new FormData;s.append("profile_image",this.selectedFile),this.isLoading.set(!0),this.http.post(`${d.N.urlRaiz}/auth/profile-image`,s,this.getAuthHeaders()).subscribe({next:o=>{this.successMessage.set("Imagen de perfil actualizada correctamente"),this.isLoading.set(!1),this.selectedFile=null;const r=d.N.urlRaiz.replace(/\/api$/,"");this.previewUrl=`${r}/assets/images/profiles/${this.currentUser?.id}.jpg?t=${(new Date).getTime()}`},error:o=>{this.errorMessage.set(o.error.message||"Error al subir la imagen"),this.isLoading.set(!1)}})}updateProfile(){if(this.profileForm.invalid)return;this.isLoading.set(!0),this.errorMessage.set(""),this.successMessage.set("");const s=this.profileForm.value;this.isAdmin()||(s.rol=this.currentUser?.rol),console.log("Enviando actualizaci\xf3n de perfil:",s),this.http.put(`${d.N.urlRaiz}/auth/profile`,s,this.getAuthHeaders()).subscribe({next:o=>{this.successMessage.set("Perfil actualizado correctamente"),this.isLoading.set(!1),o.data&&(this.authService.currentUser.set(o.data),this.currentUser=o.data)},error:o=>{console.error("Error al actualizar perfil:",o),this.errorMessage.set(o.error?.message||"Error al actualizar el perfil"),this.isLoading.set(!1)}})}updatePassword(){if(this.passwordForm.invalid)return;this.isLoading.set(!0),this.errorMessage.set(""),this.successMessage.set("");const s=this.passwordForm.value;console.log("Enviando actualizaci\xf3n de contrase\xf1a:",s),this.http.put(`${d.N.urlRaiz}/auth/change-password`,s,this.getAuthHeaders()).subscribe({next:()=>{this.successMessage.set("Contrase\xf1a actualizada correctamente"),this.isLoading.set(!1),this.passwordForm.reset(),this.showCurrentPassword.set(!1),this.showNewPassword.set(!1),this.showConfirmPassword.set(!1)},error:o=>{console.error("Error al actualizar contrase\xf1a:",o),this.errorMessage.set(o.error?.message||"Error al actualizar la contrase\xf1a"),this.isLoading.set(!1)}})}static#e=this.\u0275fac=function(o){return new(o||t)};static#r=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-cuenta"]],standalone:!0,features:[e.jDz],decls:82,vars:36,consts:[[1,"max-w-6xl","mx-auto"],[1,"text-2xl","font-bold","text-gray-800","mb-6"],["class","bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",4,"ngIf"],["class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"flex","flex-col","items-center"],[1,"w-32","h-32","bg-gray-200","rounded-full","overflow-hidden","mb-4"],["alt","Foto de perfil",1,"w-full","h-full","object-cover",3,"src"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","cursor-pointer","mb-2"],["type","file","accept","image/jpeg,image/jpg,image/png",1,"hidden",3,"change"],[1,"text-sm","text-gray-500","mb-4"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","disabled:bg-green-300","w-full",3,"disabled","click"],["class","material-icons animate-spin mr-1",4,"ngIf"],[1,"bg-white","rounded-lg","shadow-md","p-6","md:col-span-2"],[1,"space-y-4",3,"formGroup","ngSubmit"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","name","formControlName","name",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500"],["class","mt-1 text-sm text-red-600",4,"ngIf"],["for","email",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","email","id","email","formControlName","email",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500"],[4,"ngIf"],["class","hidden",4,"ngIf"],[1,"flex","justify-end"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","disabled:bg-blue-300",3,"disabled"],[1,"bg-white","rounded-lg","shadow-md","p-6","md:col-span-3"],["for","current_password",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"relative"],["id","current_password","formControlName","current_password",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500","pr-10",3,"type"],["type","button",1,"absolute","inset-y-0","right-0","pr-3","flex","items-center","text-gray-600",3,"click"],[1,"material-icons","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","password","formControlName","password",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500","pr-10",3,"type"],["for","password_confirmation",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","password_confirmation","formControlName","password_confirmation",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500","pr-10",3,"type"],[1,"bg-green-100","border","border-green-400","text-green-700","px-4","py-3","rounded","relative","mb-4"],[1,"block","sm:inline"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded","relative","mb-4"],[1,"material-icons","animate-spin","mr-1"],[1,"mt-1","text-sm","text-red-600"],["for","rol",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","rol","formControlName","rol",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500"],["value","autor"],["value","administrador"],[1,"hidden"],["type","hidden","formControlName","rol"]],template:function(o,r){if(1&o&&(e.TgZ(0,"div",0)(1,"h1",1),e._uU(2,"Configuraci\xf3n de Cuenta"),e.qZA(),e.YNc(3,y,3,1,"div",2)(4,F,3,1,"div",3),e.TgZ(5,"div",4)(6,"div",5)(7,"h2",6),e._uU(8,"Imagen de perfil"),e.qZA(),e.TgZ(9,"div",7)(10,"div",8),e._UZ(11,"img",9),e.qZA(),e.TgZ(12,"label",10)(13,"span"),e._uU(14,"Seleccionar imagen"),e.qZA(),e.TgZ(15,"input",11),e.NdJ("change",function(u){return r.onFileSelected(u)}),e.qZA()(),e.TgZ(16,"p",12),e._uU(17,"JPG o PNG. M\xe1ximo 2MB."),e.qZA(),e.TgZ(18,"button",13),e.NdJ("click",function(){return r.uploadImage()}),e.YNc(19,x,2,0,"span",14),e.TgZ(20,"span"),e._uU(21,"Subir imagen"),e.qZA()()()(),e.TgZ(22,"div",15)(23,"h2",6),e._uU(24," Informaci\xf3n de perfil "),e.qZA(),e.TgZ(25,"form",16),e.NdJ("ngSubmit",function(){return r.updateProfile()}),e.TgZ(26,"div")(27,"label",17),e._uU(28,"Nombre"),e.qZA(),e._UZ(29,"input",18),e.YNc(30,A,2,0,"p",19),e.qZA(),e.TgZ(31,"div")(32,"label",20),e._uU(33,"Correo electr\xf3nico"),e.qZA(),e._UZ(34,"input",21),e.YNc(35,P,2,0,"p",19),e.qZA(),e.YNc(36,M,8,0,"div",22)(37,I,2,0,"div",23),e.TgZ(38,"div",24)(39,"button",25),e.YNc(40,q,2,0,"span",14),e.TgZ(41,"span"),e._uU(42,"Guardar cambios"),e.qZA()()()()(),e.TgZ(43,"div",26)(44,"h2",6),e._uU(45," Cambiar contrase\xf1a "),e.qZA(),e.TgZ(46,"form",16),e.NdJ("ngSubmit",function(){return r.updatePassword()}),e.TgZ(47,"div")(48,"label",27),e._uU(49,"Contrase\xf1a actual"),e.qZA(),e.TgZ(50,"div",28),e._UZ(51,"input",29),e.TgZ(52,"button",30),e.NdJ("click",function(){return r.togglePasswordVisibility("current")}),e.TgZ(53,"span",31),e._uU(54),e.qZA()()(),e.YNc(55,N,2,0,"p",19),e.qZA(),e.TgZ(56,"div",32)(57,"div")(58,"label",33),e._uU(59,"Nueva contrase\xf1a"),e.qZA(),e.TgZ(60,"div",28),e._UZ(61,"input",34),e.TgZ(62,"button",30),e.NdJ("click",function(){return r.togglePasswordVisibility("new")}),e.TgZ(63,"span",31),e._uU(64),e.qZA()()(),e.YNc(65,J,2,0,"p",19)(66,E,2,0,"p",19),e.qZA(),e.TgZ(67,"div")(68,"label",35),e._uU(69,"Confirmar contrase\xf1a"),e.qZA(),e.TgZ(70,"div",28),e._UZ(71,"input",36),e.TgZ(72,"button",30),e.NdJ("click",function(){return r.togglePasswordVisibility("confirm")}),e.TgZ(73,"span",31),e._uU(74),e.qZA()()(),e.YNc(75,L,2,0,"p",19)(76,k,2,0,"p",19),e.qZA()(),e.TgZ(77,"div",24)(78,"button",25),e.YNc(79,O,2,0,"span",14),e.TgZ(80,"span"),e._uU(81,"Cambiar contrase\xf1a"),e.qZA()()()()()()()),2&o){let a,u,p,m,g,c,f,_,h,b,w,T;e.xp6(3),e.Q6J("ngIf",r.successMessage()),e.xp6(1),e.Q6J("ngIf",r.errorMessage()),e.xp6(7),e.Q6J("src",r.previewUrl,e.LSH),e.xp6(7),e.Q6J("disabled",!r.selectedFile||r.isLoading()),e.xp6(1),e.Q6J("ngIf",r.isLoading()&&r.selectedFile),e.xp6(6),e.Q6J("formGroup",r.profileForm),e.xp6(4),e.ekj("border-red-500",(null==(a=r.profileForm.get("name"))?null:a.invalid)&&(null==(a=r.profileForm.get("name"))?null:a.touched)),e.xp6(1),e.Q6J("ngIf",(null==(u=r.profileForm.get("name"))?null:u.invalid)&&(null==(u=r.profileForm.get("name"))?null:u.touched)),e.xp6(4),e.ekj("border-red-500",(null==(p=r.profileForm.get("email"))?null:p.invalid)&&(null==(p=r.profileForm.get("email"))?null:p.touched)),e.xp6(1),e.Q6J("ngIf",(null==(m=r.profileForm.get("email"))?null:m.invalid)&&(null==(m=r.profileForm.get("email"))?null:m.touched)),e.xp6(1),e.Q6J("ngIf",r.isAdmin()),e.xp6(1),e.Q6J("ngIf",!r.isAdmin()),e.xp6(2),e.Q6J("disabled",r.profileForm.invalid||r.isLoading()),e.xp6(1),e.Q6J("ngIf",r.isLoading()),e.xp6(6),e.Q6J("formGroup",r.passwordForm),e.xp6(5),e.ekj("border-red-500",(null==(g=r.passwordForm.get("current_password"))?null:g.invalid)&&(null==(g=r.passwordForm.get("current_password"))?null:g.touched)),e.Q6J("type",r.showCurrentPassword()?"text":"password"),e.xp6(3),e.hij(" ",r.showCurrentPassword()?"visibility_off":"visibility"," "),e.xp6(1),e.Q6J("ngIf",(null==(c=r.passwordForm.get("current_password"))?null:c.invalid)&&(null==(c=r.passwordForm.get("current_password"))?null:c.touched)),e.xp6(6),e.ekj("border-red-500",(null==(f=r.passwordForm.get("password"))?null:f.invalid)&&(null==(f=r.passwordForm.get("password"))?null:f.touched)),e.Q6J("type",r.showNewPassword()?"text":"password"),e.xp6(3),e.hij(" ",r.showNewPassword()?"visibility_off":"visibility"," "),e.xp6(1),e.Q6J("ngIf",(null==(_=r.passwordForm.get("password"))?null:_.hasError("required"))&&(null==(_=r.passwordForm.get("password"))?null:_.touched)),e.xp6(1),e.Q6J("ngIf",(null==(h=r.passwordForm.get("password"))?null:h.hasError("minlength"))&&(null==(h=r.passwordForm.get("password"))?null:h.touched)),e.xp6(5),e.ekj("border-red-500",(null==(b=r.passwordForm.get("password_confirmation"))?null:b.invalid)&&(null==(b=r.passwordForm.get("password_confirmation"))?null:b.touched)||r.passwordForm.hasError("mismatch")),e.Q6J("type",r.showConfirmPassword()?"text":"password"),e.xp6(3),e.hij(" ",r.showConfirmPassword()?"visibility_off":"visibility"," "),e.xp6(1),e.Q6J("ngIf",(null==(w=r.passwordForm.get("password_confirmation"))?null:w.hasError("required"))&&(null==(w=r.passwordForm.get("password_confirmation"))?null:w.touched)),e.xp6(1),e.Q6J("ngIf",r.passwordForm.hasError("mismatch")&&(null==(T=r.passwordForm.get("password_confirmation"))?null:T.touched)),e.xp6(2),e.Q6J("disabled",r.passwordForm.invalid||r.isLoading()),e.xp6(1),e.Q6J("ngIf",r.isLoading())}},dependencies:[Z.ez,Z.O5,n.UX,n._Y,n.YN,n.Kr,n.Fj,n.EJ,n.JJ,n.JL,n.sg,n.u],styles:["@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}button[_ngcontent-%COMP%]:not(:disabled):hover, label[_ngcontent-%COMP%]:hover{transition:all .2s ease-in-out}.rounded-full[_ngcontent-%COMP%]{border:2px solid #e2e8f0}.text-red-600[_ngcontent-%COMP%]{font-size:.875rem}.border-red-500[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #f5656533}"]})}return t})()}}]);