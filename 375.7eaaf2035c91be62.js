"use strict";(self.webpackChunkmy_primer_proy_angular=self.webpackChunkmy_primer_proy_angular||[]).push([[375],{2375:(j,d,l)=>{l.r(d),l.d(d,{ConfiguracionesComponent:()=>N});var g=l(6814),c=l(6223),f=l(8432),_=l(9315),m=l(8980),i=l(9212),p=l(4906);function v(e,t){1&e&&(i.TgZ(0,"div",6)(1,"div",7),i.O4$(),i.TgZ(2,"svg",8),i._UZ(3,"circle",9)(4,"path",10),i.qZA(),i.kcU(),i.TgZ(5,"span"),i._uU(6,"Cargando configuraciones..."),i.qZA()()())}function h(e,t){if(1&e&&(i.TgZ(0,"div",11),i._uU(1),i.qZA()),2&e){const o=i.oxw();i.xp6(1),i.hij(" ",o.error," ")}}function x(e,t){if(1&e&&(i.TgZ(0,"div",12),i._uU(1),i.qZA()),2&e){const o=i.oxw();i.xp6(1),i.hij(" ",o.successMessage," ")}}function C(e,t){if(1&e){const o=i.EpF();i.TgZ(0,"li")(1,"button",24),i.NdJ("click",function(){const a=i.CHM(o).$implicit,s=i.oxw(2);return i.KtG(s.seleccionarGrupo(a))}),i._uU(2),i.ALo(3,"titlecase"),i.qZA()()}if(2&e){const o=t.$implicit,n=i.oxw(2);i.xp6(1),i.Q6J("ngClass",n.grupoSeleccionado===o?"bg-blue-100 text-blue-700":"hover:bg-gray-100"),i.xp6(1),i.hij(" ",i.lcZ(3,2,o)," ")}}function b(e,t){if(1&e&&i._UZ(0,"img",47),2&e){const o=i.oxw(3).$implicit,n=i.oxw(3);i.Q6J("src",n.getImagenUrl(o.clave),i.LSH)}}function w(e,t){1&e&&(i.TgZ(0,"div",48)(1,"span",49),i._uU(2,"Cargando..."),i.qZA()())}function I(e,t){if(1&e&&(i.TgZ(0,"div",44),i.YNc(1,b,1,1,"img",45)(2,w,3,0,"div",46),i.qZA()),2&e){const o=i.oxw(2).$implicit,n=i.oxw(3);i.xp6(1),i.Q6J("ngIf",n.getImagenUrl(o.clave)),i.xp6(1),i.Q6J("ngIf",!n.getImagenUrl(o.clave))}}function Z(e,t){if(1&e&&(i.TgZ(0,"div",54),i._UZ(1,"img",55),i.TgZ(2,"span",56),i._uU(3),i.qZA()()),2&e){const o=i.oxw(6);i.xp6(1),i.Q6J("src",o.imagenPreview.src,i.LSH),i.xp6(2),i.Oqu(o.imagenPreview.nombre)}}function T(e,t){if(1&e&&(i.TgZ(0,"div",57),i.O4$(),i.TgZ(1,"svg",58),i._UZ(2,"path",59),i.qZA(),i.kcU(),i.TgZ(3,"span",60),i._uU(4),i.qZA()()),2&e){const o=i.oxw(6);i.xp6(4),i.Oqu(o.imagenPreview.nombre)}}function P(e,t){if(1&e&&(i.TgZ(0,"div",50)(1,"div",51),i.YNc(2,Z,4,2,"div",52)(3,T,5,1,"div",53),i.qZA()()),2&e){const o=i.oxw(5);i.xp6(2),i.Q6J("ngIf",o.imagenPreview.src),i.xp6(1),i.Q6J("ngIf",!o.imagenPreview.src&&o.imagenPreview.nombre)}}function y(e,t){if(1&e){const o=i.EpF();i.TgZ(0,"div",36)(1,"div",37),i.YNc(2,I,3,2,"div",38),i.TgZ(3,"div",39)(4,"input",40,41),i.NdJ("change",function(r){i.CHM(o);const a=i.oxw().$implicit,s=i.oxw(3);return i.KtG(s.onArchivoSeleccionado(r,a.id))}),i.qZA(),i.TgZ(6,"label",42),i._uU(7," Cambiar imagen "),i.qZA(),i.YNc(8,P,4,2,"div",43),i.qZA()()()}if(2&e){const o=i.oxw().$implicit,n=i.oxw(3);i.xp6(2),i.Q6J("ngIf",o.valor),i.xp6(2),i.Q6J("id","file_"+o.id),i.xp6(2),i.Q6J("for","file_"+o.id),i.xp6(2),i.Q6J("ngIf",n.imagenPreview&&n.editandoId===o.id)}}function G(e,t){if(1&e&&(i.TgZ(0,"div",61),i._UZ(1,"input",62)(2,"input",63),i.qZA()),2&e){const o=i.oxw().$implicit;i.xp6(1),i.Q6J("id","config_"+o.id)("formControlName","config_"+o.id),i.xp6(1),i.Q6J("formControlName","config_"+o.id)}}function U(e,t){if(1&e&&(i.TgZ(0,"div",57),i._UZ(1,"input",67),i.TgZ(2,"label",68),i._uU(3," Activar "),i.qZA()()),2&e){const o=i.oxw(2).$implicit;i.xp6(1),i.Q6J("id","config_"+o.id)("formControlName","config_"+o.id)("value","1"),i.xp6(1),i.Q6J("for","config_"+o.id)}}function A(e,t){if(1&e&&i._UZ(0,"input",69),2&e){const o=i.oxw(2).$implicit;i.Q6J("id","config_"+o.id)("formControlName","config_"+o.id)}}function E(e,t){if(1&e&&i._UZ(0,"textarea",70),2&e){const o=i.oxw(2).$implicit;i.Q6J("id","config_"+o.id)("formControlName","config_"+o.id)}}function J(e,t){if(1&e&&i._UZ(0,"input",71),2&e){const o=i.oxw(2).$implicit;i.Q6J("id","config_"+o.id)("formControlName","config_"+o.id)}}function M(e,t){if(1&e&&(i.TgZ(0,"div",36),i.YNc(1,U,4,4,"div",53)(2,A,1,2,"input",64)(3,E,1,2,"textarea",65)(4,J,1,2,"input",66),i.qZA()),2&e){const o=i.oxw().$implicit;i.xp6(1),i.Q6J("ngIf","booleano"===o.tipo),i.xp6(1),i.Q6J("ngIf","numero"===o.tipo),i.xp6(1),i.Q6J("ngIf","json"===o.tipo),i.xp6(1),i.Q6J("ngIf","texto"===o.tipo)}}function O(e,t){if(1&e&&(i.TgZ(0,"div",30)(1,"div",31)(2,"label",32),i._uU(3),i.qZA(),i.YNc(4,y,9,4,"div",33)(5,G,3,3,"div",34)(6,M,5,4,"div",33),i.qZA(),i.TgZ(7,"p",35),i._uU(8),i.qZA()()),2&e){const o=t.$implicit,n=i.oxw(3);i.xp6(2),i.Q6J("for","config_"+o.id),i.xp6(1),i.hij(" ",o.descripcion," "),i.xp6(1),i.Q6J("ngIf",n.esImagen(o.tipo)),i.xp6(1),i.Q6J("ngIf",n.esColor(o.tipo)),i.xp6(1),i.Q6J("ngIf",!n.esImagen(o.tipo)&&!n.esColor(o.tipo)),i.xp6(2),i.AsE(" Clave: ",o.clave," | Tipo: ",o.tipo," ")}}function Q(e,t){if(1&e){const o=i.EpF();i.TgZ(0,"form",25),i.NdJ("ngSubmit",function(){i.CHM(o);const r=i.oxw(2);return i.KtG(r.guardarGrupo(r.grupoSeleccionado))}),i.TgZ(1,"div",26),i.YNc(2,O,9,7,"div",27),i.qZA(),i.TgZ(3,"div",28)(4,"button",29),i._uU(5," Guardar configuraciones "),i.qZA()()()}if(2&e){const o=i.oxw(2);i.Q6J("formGroup",o.formConfiguracionesGrupo[o.grupoSeleccionado]),i.xp6(2),i.Q6J("ngForOf",o.configuracionesPorGrupo.configuraciones[o.grupoSeleccionado]),i.xp6(2),i.Q6J("disabled",o.loading||o.formConfiguracionesGrupo[o.grupoSeleccionado].invalid)}}function S(e,t){if(1&e&&(i.TgZ(0,"div",13)(1,"div",14)(2,"div",15)(3,"h2",16),i._uU(4,"Categor\xedas"),i.qZA(),i.TgZ(5,"ul",17),i.YNc(6,C,4,4,"li",18),i.qZA()()(),i.TgZ(7,"div",19)(8,"div",20)(9,"div",21)(10,"h2",22),i._uU(11),i.ALo(12,"titlecase"),i.qZA()(),i.YNc(13,Q,6,3,"form",23),i.qZA()()()),2&e){const o=i.oxw();i.xp6(6),i.Q6J("ngForOf",o.configuracionesPorGrupo.grupos),i.xp6(5),i.hij(" Configuraciones de ",i.lcZ(12,3,o.grupoSeleccionado)," "),i.xp6(2),i.Q6J("ngIf",o.formConfiguracionesGrupo[o.grupoSeleccionado])}}let N=(()=>{class e{constructor(o,n){this.configuracionesService=o,this.fb=n,this.loading=!0,this.error=null,this.successMessage=null,this.grupoSeleccionado="general",this.editandoId=null,this.formConfiguracionesGrupo={},this.imagenesUrls={},this.imagenPreview=null,this.archivosImagenes=new Map,this.formConfiguracion=this.fb.group({valor:["",c.kI.required],archivo:[null]})}ngOnInit(){this.cargarConfiguraciones()}cargarConfiguraciones(){this.loading=!0,this.error=null,this.configuracionesService.getConfiguracionesPorGrupo().subscribe({next:o=>{this.configuracionesPorGrupo=o,this.loading=!1,this.inicializarFormulariosPorGrupo(),this.precargarImagenesUrls()},error:o=>{this.error=o.message||"Error al cargar las configuraciones",this.loading=!1}})}precargarImagenesUrls(){this.configuracionesPorGrupo&&Object.values(this.configuracionesPorGrupo.configuraciones).forEach(o=>{o.forEach(n=>{"imagen"===n.tipo&&this.configuracionesService.getImagenUrl(n.clave).subscribe(r=>{this.imagenesUrls[n.clave]=r})})})}inicializarFormulariosPorGrupo(){this.configuracionesPorGrupo&&this.configuracionesPorGrupo.grupos.forEach(o=>{const r={};(this.configuracionesPorGrupo?.configuraciones[o]||[]).forEach(a=>{r[`config_${a.id}`]=[a.valor]}),this.formConfiguracionesGrupo[o]=this.fb.group(r)})}seleccionarGrupo(o){this.grupoSeleccionado=o,this.imagenPreview=null}editarConfiguracion(o){this.editandoId=o.id,this.formConfiguracion.patchValue({valor:o.valor,archivo:null}),this.imagenPreview=null}cancelarEdicion(){this.editandoId=null,this.formConfiguracion.reset(),this.imagenPreview=null}onArchivoSeleccionado(o,n){const r=o.target;if(r.files&&r.files.length>0){const a=r.files[0];this.editandoId=n,this.formConfiguracion.patchValue({archivo:a}),this.archivosImagenes.set(n,a),this.mostrarPreviewImagen(a)}}mostrarPreviewImagen(o){if(this.imagenPreview={nombre:o.name},o.type.startsWith("image/")){const n=new FileReader;n.onload=r=>{this.imagenPreview&&(this.imagenPreview.src=r.target.result)},n.readAsDataURL(o)}}guardarConfiguracion(){if(this.formConfiguracion.invalid||null===this.editandoId)return;const{valor:o,archivo:n}=this.formConfiguracion.value;this.loading=!0,n?this.configuracionesService.subirImagen(this.editandoId,n).subscribe({next:r=>{this.finalizarGuardado(r)},error:r=>this.manejarError(r)}):this.configuracionesService.updateConfiguracion(this.editandoId,{valor:o,archivo:n}).subscribe({next:r=>{this.finalizarGuardado(r)},error:r=>this.manejarError(r)})}finalizarGuardado(o){this.loading=!1,this.successMessage="Configuraci\xf3n actualizada correctamente",this.configuracionesService.clearCache(),this.imagenesUrls={},this.imagenPreview=null,this.archivosImagenes.clear(),this.cargarConfiguraciones(),this.cancelarEdicion(),setTimeout(()=>this.successMessage=null,3e3)}manejarError(o){this.loading=!1,this.error=o.message||"Error al actualizar la configuraci\xf3n",setTimeout(()=>this.error=null,3e3)}guardarGrupo(o){if(!this.formConfiguracionesGrupo[o]||this.formConfiguracionesGrupo[o].invalid)return;this.loading=!0;const r=this.obtenerConfiguracionesImagenes(o);if(r.length>0){const a=r.map(s=>this.configuracionesService.subirImagen(s.id,s.archivo));(0,_.D)(a).subscribe({next:()=>{this.guardarValoresDeGrupo(o)},error:s=>this.manejarError(s)})}else this.guardarValoresDeGrupo(o)}obtenerConfiguracionesImagenes(o){if(!this.configuracionesPorGrupo)return[];const r=[];return(this.configuracionesPorGrupo.configuraciones[o]||[]).forEach(a=>{if("imagen"===a.tipo&&this.archivosImagenes.has(a.id)){const s=this.archivosImagenes.get(a.id);s&&r.push({id:a.id,archivo:s})}}),r}guardarValoresDeGrupo(o){const r=this.formConfiguracionesGrupo[o].value,a=[];Object.keys(r).forEach(s=>{if(s.startsWith("config_")){const u=parseInt(s.replace("config_",""));this.archivosImagenes.has(u)||a.push({id:u,valor:r[s]})}}),a.length>0?this.configuracionesService.updateMultiple({configuraciones:a}).subscribe({next:u=>{this.finalizarGuardadoGrupo(u.mensaje)},error:u=>this.manejarError(u)}):this.finalizarGuardadoGrupo("Configuraciones actualizadas correctamente")}finalizarGuardadoGrupo(o){this.loading=!1,this.successMessage=o,this.configuracionesService.clearCache(),this.imagenesUrls={},this.archivosImagenes.clear(),this.imagenPreview=null,this.cargarConfiguraciones(),setTimeout(()=>this.successMessage=null,3e3)}esImagen(o){return"imagen"===o}esColor(o){return"color"===o}getImagenUrl(o){return this.imagenesUrls[o]?this.imagenesUrls[o]:""}static#i=this.\u0275fac=function(n){return new(n||e)(i.Y36(p.C),i.Y36(c.qu))};static#o=this.\u0275cmp=i.Xpm({type:e,selectors:[["app-configuraciones"]],standalone:!0,features:[i.jDz],decls:7,vars:4,consts:[["appHasRole","administrador",1,"container","mx-auto","px-4","py-6"],[1,"text-2xl","font-bold","mb-6"],["class","mb-4",4,"ngIf"],["class","mb-4 p-4 bg-red-50 text-red-600 rounded border border-red-200",4,"ngIf"],["class","mb-4 p-4 bg-green-50 text-green-600 rounded border border-green-200",4,"ngIf"],["class","grid grid-cols-12 gap-6",4,"ngIf"],[1,"mb-4"],[1,"flex","items-center","justify-center","p-4","bg-blue-50","rounded"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","mr-3","text-blue-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"mb-4","p-4","bg-red-50","text-red-600","rounded","border","border-red-200"],[1,"mb-4","p-4","bg-green-50","text-green-600","rounded","border","border-green-200"],[1,"grid","grid-cols-12","gap-6"],[1,"col-span-12","md:col-span-3"],[1,"bg-white","rounded-lg","shadow","p-4"],[1,"font-semibold","text-lg","mb-4"],[1,"space-y-2"],[4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-9"],[1,"bg-white","rounded-lg","shadow"],[1,"p-4","border-b"],[1,"font-semibold","text-lg"],["class","p-4",3,"formGroup","ngSubmit",4,"ngIf"],[1,"w-full","text-left","py-2","px-3","rounded","transition-colors",3,"ngClass","click"],[1,"p-4",3,"formGroup","ngSubmit"],[1,"space-y-4"],["class","border-b pb-4 last:border-b-0",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end"],["type","submit",1,"bg-blue-600","hover:bg-blue-700","text-white","py-2","px-4","rounded",3,"disabled"],[1,"border-b","pb-4","last:border-b-0"],[1,"flex","flex-col","md:flex-row","md:items-center","mb-1"],[1,"font-medium","text-gray-700","md:w-1/3",3,"for"],["class","md:w-2/3 mt-2 md:mt-0",4,"ngIf"],["class","md:w-2/3 mt-2 md:mt-0 flex items-center space-x-2",4,"ngIf"],[1,"text-xs","text-gray-500","ml-0","md:ml-1/3","mt-1"],[1,"md:w-2/3","mt-2","md:mt-0"],[1,"flex","items-center","space-x-4"],["class","relative w-24 h-24 border rounded overflow-hidden",4,"ngIf"],[1,"flex","flex-col","space-y-2"],["type","file","accept","image/*",1,"hidden",3,"id","change"],["fileInput",""],[1,"cursor-pointer","bg-blue-600","hover:bg-blue-700","text-white","py-2","px-4","rounded","inline-block",3,"for"],["class","mt-2",4,"ngIf"],[1,"relative","w-24","h-24","border","rounded","overflow-hidden"],["alt","Vista previa","class","w-full h-full object-contain",3,"src",4,"ngIf"],["class","w-full h-full flex items-center justify-center bg-gray-100",4,"ngIf"],["alt","Vista previa",1,"w-full","h-full","object-contain",3,"src"],[1,"w-full","h-full","flex","items-center","justify-center","bg-gray-100"],[1,"text-xs","text-gray-500"],[1,"mt-2"],[1,"bg-gray-50","p-2","rounded","border","text-sm"],["class","flex flex-col items-center",4,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"flex","flex-col","items-center"],["alt","Vista previa nueva",1,"max-h-24","max-w-full","mb-1","object-contain",3,"src"],[1,"text-xs","text-gray-600","truncate","max-w-full"],[1,"flex","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","mr-1","text-blue-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"text-xs","text-gray-600","truncate"],[1,"md:w-2/3","mt-2","md:mt-0","flex","items-center","space-x-2"],["type","color",1,"w-12","h-8","rounded","border",3,"id","formControlName"],["type","text",1,"flex-1","border","rounded","py-2","px-3",3,"formControlName"],["type","number","class","w-full border rounded py-2 px-3",3,"id","formControlName",4,"ngIf"],["rows","4","class","w-full border rounded py-2 px-3",3,"id","formControlName",4,"ngIf"],["type","text","class","w-full border rounded py-2 px-3",3,"id","formControlName",4,"ngIf"],["type","checkbox",1,"w-4","h-4","text-blue-600","rounded","focus:ring-blue-500",3,"id","formControlName","value"],[1,"ml-2","text-gray-700",3,"for"],["type","number",1,"w-full","border","rounded","py-2","px-3",3,"id","formControlName"],["rows","4",1,"w-full","border","rounded","py-2","px-3",3,"id","formControlName"],["type","text",1,"w-full","border","rounded","py-2","px-3",3,"id","formControlName"]],template:function(n,r){1&n&&(i.TgZ(0,"div",0)(1,"h1",1),i._uU(2,"Configuraci\xf3n del Sistema"),i.qZA(),i.YNc(3,v,7,0,"div",2)(4,h,2,1,"div",3)(5,x,2,1,"div",4)(6,S,14,5,"div",5),i.qZA()),2&n&&(i.xp6(3),i.Q6J("ngIf",r.loading),i.xp6(1),i.Q6J("ngIf",r.error),i.xp6(1),i.Q6J("ngIf",r.successMessage),i.xp6(1),i.Q6J("ngIf",r.configuracionesPorGrupo&&!r.loading))},dependencies:[g.ez,g.mk,g.sg,g.O5,g.rS,c.UX,c._Y,c.Fj,c.wV,c.Wl,c.JJ,c.JL,c.sg,c.u,f.Bz,m.c],styles:["input[type=color][_ngcontent-%COMP%]{-webkit-appearance:none;border:none;cursor:pointer}input[type=color][_ngcontent-%COMP%]::-webkit-color-swatch-wrapper{padding:0}input[type=color][_ngcontent-%COMP%]::-webkit-color-swatch{border:none;border-radius:4px}@keyframes _ngcontent-%COMP%_fadeOut{0%{opacity:1}to{opacity:0}}.fadeout[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeOut .5s ease-out forwards}input[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 2px #3b82f640}.img-preview[_ngcontent-%COMP%]{transition:transform .2s ease-in-out}.img-preview[_ngcontent-%COMP%]:hover{transform:scale(1.05)}"]})}return e})()}}]);